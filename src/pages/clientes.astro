---
import DashboardLayout from '../layouts/DashboardLayout.astro';
import DynamicForm from '../components/DynamicForm.astro';
import DynamicModal from '../components/DynamicModal.astro';
import DynamicTable from '../components/DynamicTable.astro';
import { db, Cliente, desc } from 'astro:db';

// 1. Obtener datos
const clientes = await db.select().from(Cliente).orderBy(desc(Cliente.id));

// 2. Configurar Columnas
const columnasClientes = [
    { key: 'nombre', label: 'Razón Social' },
    { key: 'observaciones', label: 'Observaciones / Info' },
    { key: 'id', label: 'Gestión', type: 'action', align: 'right' }
];

// 3. Configurar Campos Formulario (por si no lo tenías)
const camposClientes = [
    { name: 'nombre', label: 'Nombre', type: 'text', placeholder: 'Ej: Logística Sur' },
    { name: 'observaciones', label: 'Observaciones', type: 'text', placeholder: 'Opcional', required: false }
];
---

<DashboardLayout title="Gestión de Clientes">
    <div class="space-y-12">
        <DynamicForm 
            title="Directorio"
            subtitle="Alta de Cliente"
            fields={camposClientes}
            actionName="upsertClient"
            buttonText="Añadir"
        />

        <DynamicTable 
            id="clientes"
            columns={columnasClientes}
            data={clientes}
            searchPlaceholder="Buscar cliente por nombre o CIF..."
        />
    </div>
    <DynamicModal />
</DashboardLayout>