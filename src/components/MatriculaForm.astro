---
const { clientes } = Astro.props;
---

<div class="bg-white p-8 rounded-[2.5rem] border-2 border-brand-light shadow-sm">
    <form id="matricula-form" class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
        <input type="hidden" name="id" />
        
        <div>
            <label class="block text-[10px] font-black text-brand uppercase mb-2 ml-1 tracking-wider">Número de Matrícula</label>
            <input 
                type="text" 
                name="numero" 
                placeholder="Ej: 1234BBB"
                class="w-full p-4 bg-brand/5 border-2 border-brand/10 rounded-2xl outline-none focus:border-brand transition-all font-bold text-brand-deep placeholder:opacity-30 uppercase"
                required
            />
        </div>

        <div>
            <label class="block text-[10px] font-black text-brand uppercase mb-2 ml-1 tracking-wider">Asignar a Cliente</label>
            <div class="relative">
                <input 
                    list="clientes-list" 
                    name="clienteNombre" 
                    placeholder="Escribe para buscar..."
                    class="w-full p-4 bg-brand/5 border-2 border-brand/10 rounded-2xl outline-none focus:border-brand transition-all font-bold text-brand-deep placeholder:opacity-30"
                    required
                />
                <datalist id="clientes-list">
                    {clientes.map((c) => <option value={c.nombre} />)}
                </datalist>
            </div>
        </div>
        <button
            type="submit"
            class="w-full w-auto bg-brand text-white font-black px-10 py-4 rounded-2xl
                   hover:bg-brand-deep hover:shadow-xl hover:shadow-brand/30
                   active:scale-95 transition-all flex items-center gap-3 group"
        >
            <span class="uppercase tracking-tighter">Añadir Matrícula</span>
        </button>
    </form>
</div>

<script>
    import { actions } from 'astro:actions';
    const form = document.getElementById('matricula-form') as HTMLFormElement;
    
    form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const { error } = await actions.upsertMatricula(new FormData(form));
        if (!error) window.location.reload();
        else alert(error.message);
    });
</script>